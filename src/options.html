<html class="page-options">
  <head>
    <title>Critical Start</title>
    <script type="module" src="./js/options.js"></script>
  </head>

  <body>
    <!-- Header -->
    <header class="container d-flex mb-3">
      <div>
        <a href="http://www.criticalstart.com/threat-analytics-chrome-plugin/" title="Threat Analytics Chrome plugin notes">
          <img src="./images/icon_128.png" alt="Critical Start logo" height="90px">
        </a>
      </div>
      <div class="flex-grow-1 pl-3">
        <h1 class="mb-1">Critical Start</h1>
        <nav>Loading...</nav>
        <script id="template-header-nav" type="x-tmpl-mustache">
          <ul class="nav nav-tabs">
            {{#tabs}}
              <li class="nav-item">
                <a
                  class="nav-link {{ classes }}"
                  data-tab="{{ page }}"
                  href="{{ href }}"
                  {{ attributes }}
                >{{ label }}</a>
              </li>
            {{/tabs}}
          </ul>
        </script>
      </div>
      <div id="links" class="d-flex align-items-end"> Loading...</div> 
      <script id="template-header-links" type="x-tmpl-mustache">
        {{#links}}
          <div class="mx-2 pb-2">
            <a href="{{ href }}" title="{{ title }}" target="_blank">
              <i class="{{ icon }}" aria-hidden="true"></i>
              {{ label }}
            </a>
          </div>
        {{/links}}
      </script>
    </header>

    <!-- Tabs content -->
    <main class="container">
      <section data-tab="settings">
        Loading...
      </section>

      <section data-tab="search-providers">
        Loading...
      </section>

      <section data-tab="security-analytics">
        <h2>Security Analytics Configuration</h2>

        <form name="rsaConfig">
          <div id="rsa_config">Loading...</div>
        </form>

        <h3>Manage Pivot Queries</h3>

        <form name="rsaQueries">
          <div id="rsa_queries">Loading...</div>
        </form>
      </section>

      <section data-tab="netwitness">
        <h2>NetWitness Investigator</h2>

        <form name="nwiConfig">
          <div id="nwi_config">Loading...</div>
        </form>

        <h3>Manage Pivot Queries</h3>

        <form name="nwiQueries">
          <div id="nwi_queries">Loading...</div>
        </form>
      </section>

      <section data-tab="carbon-black">
        <h2>Carbon Black Configuration</h2>

        <form name="cbcConfig">
          <div id="cbc_config">Loading...</div>
        </form>

        <h3>Manage Pivot Queries</h3>

        <form name="cbcQueries">
          <div id="cbc_queries">Loading...</div>
        </form>
      </section>
    </main>

    <!-- Templates for CBC, NWI and SRA -->
    <script id="template_providerConfig" type="x-tmpl-mustache">
      <div class="row">
        {{#items}}
          <div class="col-md-6 align-self-end">
            {{^isCheckbox}}
              <div class="mt-2">
                <label
                  class="mb-0"
                  for="subSettings_{{ key }}"
                  >{{ label }}</label>
                <input
                  type="{{ type }}"
                  class="form-control"
                  name="{{ key }}"
                  id="subSettings_{{ key }}"
                  placeholder="{{ placeholder }}"
                  value="{{ value }}">
              </div>
            {{/isCheckbox}}
            {{#isCheckbox}}
              <div class="form-check my-3">
                <input
                  type="checkbox"
                  class="form-check-input"
                  name="{{ key }}" 
                  id="subSettings_{{ key }}"
                  {{ checked }}
                  value="yes">
                <label
                  class="form-check-label"
                  for="subSettings_{{ key }}">
                  {{ label }}
                </label>
              </div>
            {{/isCheckbox}}
          </div>
        {{/items}}
      </div>
      <div class="text-right">
        <button type="reset" class="btn btn-outline-danger">Undo recent changes</button>
      </div>
    </script>

    <script id="template_providerQueries" type="x-tmpl-mustache">
      <ul class="list-group">
        {{#items}}
          <li class="list-group-item sortable pl-1 pr-2 py-3" data-index="{{ index }}">
            <div class="d-flex align-items-center">

              <div class="sortable-handle p-2">
                <i class="fas fa-arrows-alt text-large" aria-hidden="true"></i>
              </div>

              <div class="flex-1 mx-2">
                <input
                  type="text"
                  value="{{ label }}"
                  class="form-control text-black"
                  placeholder="Label to be used in the context menu"
                  name="label_{{ index }}">
              </div>

              <div class="flex-2 mx-2">
                <input
                  type="text"
                  value="{{ query }}"
                  class="form-control text-info"
                  placeholder="Query to be used on the requests"
                  name="query_{{ index }}">
              </div>

              <div class="form-check mx-2">
                <input
                  type="checkbox"
                  value="yes"
                  {{ enabled }}
                  class="form-check-input"
                  name="enabled_{{ index }}"
                  id="{{ formName }}_enabled_{{ index }}">
                <label
                  class="form-check-label"
                  for="{{ formName }}_enabled_{{ index }}">
                  Enabled
                </label>
              </div>

              <div>
                <button
                  type="button"
                  class="btn btn-outline-danger py-0 px-1"
                  title="Delete"
                  name="delete_{{ index }}">
                  <i class="fas fa-minus-circle" aria-hidden="true"></i>
                  Delete
                </button>
              </div>

            </div>
          </li>
        {{/items}}

        <li class="list-group-item pl-1 pr-2">
          <div class="d-flex align-items-center">

            <div class="px-2 py-3">
              <i class="fas fa-plus text-extra-large text-primary" aria-hidden="true"></i>
            </div>

            <div class="flex-1 mx-2">
              <input
                type="text"
                value=""
                class="form-control text-black"
                placeholder="Label to be used in the context menu"
                name="label_new">
            </div>

            <div class="flex-2 mx-2">
              <input
                type="text"
                value=""
                class="form-control text-info"
                placeholder="Query to be used on the requests"
                name="query_new">
            </div>

            <div>
              <button
                type="button"
                class="btn btn-success"
                title="Add"
                name="add_new">
                <i class="fas fa-plus-circle" aria-hidden="true"></i>
                Add new query
              </button>
            </div>

          </div>
          <div class="alert alert-info text-small py-1 px-2 mt-2 ml-1 mb-0" role="alert">
            To add a new query, replace the search term with "TESTSEARCH" in your query and copy the query to the 'Query' field below.
          </div>
        </li>
      </ul>
      <div class="text-right mt-2">
        <button type="reset" class="btn btn-outline-danger">Undo recent changes</button>
      </div>
    </script>

    <!-- Footer -->
    <footer class="text-center mt-3 pb-2">
      <hr class="my-2" />
      <small class="text-muted">
        Copyright 2015-2021 © Critical Start. All rights reserved.
        <br><a target="_blank" href="https://www.criticalstart.com">https://www.criticalstart.com</a>
      </small>
    </footer>
  </body>
</html>